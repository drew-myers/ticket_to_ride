---
id: ttr-0008
status: open
deps: [ttr-0003, ttr-0004, ttr-0007]
links: []
created: 2026-01-29T18:07:00Z
type: task
priority: 1
assignee: acmyers
parent: ttr-0001
tags: [sync, core]
external-ref: gh-18
---
# Core Sync Logic

Implement the main sync orchestration that ties everything together.

## Description

Implement in `src/sync.rs`:

### SyncEngine
- `SyncEngine::new(config, client)` 
- `SyncEngine::push(tickets)` - main sync entry point
- `SyncEngine::push_ticket(ticket)` - sync single ticket

### Push Logic

For each ticket:

1. **No external-ref** (new ticket):
   - Format issue body with marker and content
   - Create GitHub issue
   - Apply labels from ticket tags
   - Assign to configured assignee
   - Write `external-ref: gh-{number}` back to ticket file

2. **Has external-ref: gh-{number}** (existing ticket):
   - Fetch issue from GitHub
   - Check for `<!-- ticket:{id} -->` marker
   - If marker matches: update issue (title, body, state, labels)
   - If marker missing/mismatch: warn and skip

### Issue Body Formatting
- Include marker comment at top
- Include ticket description
- Include Design section if present
- Include Acceptance Criteria if present
- Skip Notes section (local only)
- Add footer with ticket reference

### State Sync
- open/in_progress → issue open
- closed → issue closed

## Acceptance Criteria

- [ ] Creates new issues for tickets without external-ref
- [ ] Writes external-ref back to ticket file after creation
- [ ] Updates existing issues when ticket changes
- [ ] Skips with warning when issue was modified outside ttr
- [ ] Syncs ticket state to issue state
- [ ] Applies labels from ticket tags
- [ ] Assigns to configured assignee
- [ ] Formats issue body correctly with marker
